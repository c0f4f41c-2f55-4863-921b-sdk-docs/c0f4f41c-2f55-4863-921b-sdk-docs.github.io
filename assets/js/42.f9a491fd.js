(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{433:function(e,t,a){"use strict";a.r(t);var n=a(11),s=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"provider-migration-guide"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#provider-migration-guide"}},[e._v("#")]),e._v(" Provider Migration Guide")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("Attention MetaMask Users")]),e._v(" "),a("p",[e._v("If you are a MetaMask user attempting to use a legacy Ethereum website that hasn't migrated to the new API,\nplease see the section on the "),a("a",{attrs:{href:"#using-the-metamask-legacy-web3-extension"}},[e._v("MetaMask Legacy Web3 Extension")]),e._v(".")]),e._v(" "),a("p",[e._v("Except for such legacy websites, no action is required for MetaMask users.")])]),e._v(" "),a("p",[e._v("In January of 2021, we made a number of breaking changes to our provider API, and removed our injected "),a("code",[e._v("window.web3")]),e._v(".\nThese changes are live on all platforms as of version:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("9.0.2")]),e._v(" of the MetaMask browser extension")]),e._v(" "),a("li",[a("code",[e._v("1.0.9")]),e._v(" of MetaMask Mobile")])]),e._v(" "),a("p",[e._v("This guide describes how to migrate to the new provider API, and how to replace our "),a("code",[e._v("window.web3")]),e._v(".\nTo understand why we made these changes, please see "),a("a",{attrs:{href:"https://medium.com/metamask/breaking-changes-to-the-metamask-provider-are-here-7b11c9388be9",target:"_blank",rel:"noopener noreferrer"}},[e._v("this blog post"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"table-of-contents"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#table-of-contents"}},[e._v("#")]),e._v(" Table of Contents")]),e._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#table-of-contents"}},[e._v("Table of Contents")])]),a("li",[a("a",{attrs:{href:"#summary-of-breaking-changes"}},[e._v("Summary of Breaking Changes")]),a("ul",[a("li",[a("a",{attrs:{href:"#window-web3-removal"}},[e._v("window.web3 Removal")])]),a("li",[a("a",{attrs:{href:"#window-ethereum-api-changes"}},[e._v("window.ethereum API Changes")])])])]),a("li",[a("a",{attrs:{href:"#replacing-window-web3"}},[e._v("Replacing window.web3")]),a("ul",[a("li",[a("a",{attrs:{href:"#using-window-ethereum-directly"}},[e._v("Using window.ethereum Directly")])]),a("li",[a("a",{attrs:{href:"#using-an-updated-convenience-library"}},[e._v("Using an Updated Convenience library")])]),a("li",[a("a",{attrs:{href:"#using-metamask-legacy-web3"}},[e._v("Using @metamask/legacy-web3")])]),a("li",[a("a",{attrs:{href:"#using-the-metamask-legacy-web3-extension"}},[e._v("Using the MetaMask Legacy Web3 Extension")])])])]),a("li",[a("a",{attrs:{href:"#migrating-to-the-new-provider-api"}},[e._v("Migrating to the New Provider API")]),a("ul",[a("li",[a("a",{attrs:{href:"#handling-eth-chainid-return-values"}},[e._v("Handling eth_chainId Return Values")])]),a("li",[a("a",{attrs:{href:"#handling-the-removal-of-chainidchanged"}},[e._v("Handling the Removal of chainIdChanged")])]),a("li",[a("a",{attrs:{href:"#handling-the-removal-of-isenabled-and-isapproved"}},[e._v("Handling the Removal of isEnabled() and isApproved()")])]),a("li",[a("a",{attrs:{href:"#handling-the-removal-of-ethereum-publicconfigstore"}},[e._v("Handling the Removal of ethereum.publicConfigStore")])]),a("li",[a("a",{attrs:{href:"#handling-the-removal-of-ethereum-autorefreshonnetworkchange"}},[e._v("Handling the Removal of ethereum.autoRefreshOnNetworkChange")])])])])])]),a("p"),e._v(" "),a("h2",{attrs:{id:"summary-of-breaking-changes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary-of-breaking-changes"}},[e._v("#")]),e._v(" Summary of Breaking Changes")]),e._v(" "),a("h3",{attrs:{id:"window-web3-removal"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#window-web3-removal"}},[e._v("#")]),e._v(" "),a("code",[e._v("window.web3")]),e._v(" Removal")]),e._v(" "),a("p",[e._v("As part of the breaking changes, we stopped injecting "),a("code",[e._v("web3.js")]),e._v(" version "),a("code",[e._v("0.20.7")]),e._v(" as "),a("code",[e._v("window.web3")]),e._v(" into web pages.\nMetaMask still injects a dummy object at "),a("code",[e._v("window.web3")]),e._v(", in order to issue warnings when websites attempt to access "),a("code",[e._v("window.web3")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"window-ethereum-api-changes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#window-ethereum-api-changes"}},[e._v("#")]),e._v(" "),a("code",[e._v("window.ethereum")]),e._v(" API Changes")]),e._v(" "),a("p",[e._v("We made the following breaking changes to the "),a("code",[e._v("window.ethereum")]),e._v(" API:")]),e._v(" "),a("ul",[a("li",[e._v("Ensure that chain IDs returned by "),a("code",[e._v("eth_chainId")]),e._v(" are "),a("strong",[e._v("not")]),e._v(" 0-padded\n"),a("ul",[a("li",[e._v("For example, instead of "),a("code",[e._v("0x01")]),e._v(", we always return "),a("code",[e._v("0x1")]),e._v(", wherever the chain ID is returned or accessible.")]),e._v(" "),a("li",[e._v("Note that this "),a("em",[e._v("only")]),e._v(" affects the "),a("RouterLink",{attrs:{to:"/guide/ethereum-provider.html#chain-ids"}},[e._v("default Ethereum chains")]),e._v(", "),a("em",[e._v("except")]),e._v(" Kovan, whose chain ID is formatted correctly ("),a("code",[e._v("0x2a")]),e._v(").")],1)])]),e._v(" "),a("li",[e._v("Stop emitting "),a("code",[e._v("chainIdChanged")]),e._v(", and instead emit "),a("code",[e._v("chainChanged")])]),e._v(" "),a("li",[e._v("Remove the following experimental methods:\n"),a("ul",[a("li",[a("code",[e._v("ethereum._metamask.isEnabled")])]),e._v(" "),a("li",[a("code",[e._v("ethereum._metamask.isApproved")])])])]),e._v(" "),a("li",[e._v("Remove the "),a("code",[e._v("ethereum.publicConfigStore")]),e._v(" object\n"),a("ul",[a("li",[e._v("This object was, despite its name, never intended for public consumption.\nIts removal "),a("em",[e._v("may")]),e._v(" affect those who do not use it directly, e.g. if another library you use relies on the object.")])])]),e._v(" "),a("li",[e._v("Remove the "),a("code",[e._v("ethereum.autoRefreshOnNetworkChange")]),e._v(" property\n"),a("ul",[a("li",[e._v("Consumers can still set this property on the provider, it just won't do anything.")])])]),e._v(" "),a("li",[e._v("Deprecate the "),a("code",[e._v("web3.currentProvider")]),e._v(" method\n"),a("ul",[a("li",[e._v("Use "),a("a",{attrs:{href:"https://github.com/MetaMask/detect-provider",target:"_blank",rel:"noopener noreferrer"}},[e._v("@metamask/detect-provider"),a("OutboundLink")],1),e._v(" to detect the current provider.")])])])]),e._v(" "),a("h2",{attrs:{id:"replacing-window-web3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#replacing-window-web3"}},[e._v("#")]),e._v(" Replacing "),a("code",[e._v("window.web3")])]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("Pages No Longer Reload on Chain Changes")]),e._v(" "),a("p",[e._v("Since we removed our "),a("code",[e._v("window.web3")]),e._v(", MetaMask no longer automatically reloads the page on chain/network changes.")]),e._v(" "),a("p",[e._v("Please see "),a("a",{attrs:{href:"#handling-the-removal-of-ethereum-autorefreshonnetworkchange"}},[e._v("Handling the Removal of "),a("code",[e._v("ethereum.autoRefreshOnNetworkChange")])]),e._v(" for details.")])]),e._v(" "),a("p",[e._v("For historical reasons, MetaMask injected "),a("a",{attrs:{href:"https://github.com/ethereum/web3.js/tree/0.20.7",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("web3@0.20.7")]),a("OutboundLink")],1),e._v(" into all web pages.\nThat version of "),a("code",[e._v("web3")]),e._v(" is deprecated, "),a("a",{attrs:{href:"https://github.com/ethereum/web3.js/issues/3065",target:"_blank",rel:"noopener noreferrer"}},[e._v("has known security issues"),a("OutboundLink")],1),e._v(", and is no longer maintained by the "),a("a",{attrs:{href:"https://github.com/ethereum/web3.js/",target:"_blank",rel:"noopener noreferrer"}},[e._v("web3.js"),a("OutboundLink")],1),e._v(" team.\nTherefore, we decided to remove this library.")]),e._v(" "),a("p",[e._v("If your website relied on our "),a("code",[e._v("window.web3")]),e._v(" object, you have to migrate.\nPlease continue reading to understand your options.\nSome are as simple as a one-line change.")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("Tip")]),e._v(" "),a("p",[e._v("Regardless of how you choose to migrate, you may want to read the "),a("code",[e._v("web3@0.20.7")]),e._v(" documentation, which you can find "),a("a",{attrs:{href:"https://github.com/ethereum/web3.js/blob/0.20.7/DOCUMENTATION.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(".")])]),e._v(" "),a("h3",{attrs:{id:"using-window-ethereum-directly"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-window-ethereum-directly"}},[e._v("#")]),e._v(" Using "),a("code",[e._v("window.ethereum")]),e._v(" Directly")]),e._v(" "),a("p",[e._v("For many web3 sites, the API provided by "),a("code",[e._v("window.ethereum")]),e._v(" is sufficient.\nMuch of the "),a("code",[e._v("web3")]),e._v(" API simply maps to RPC methods, all of which can be requested using "),a("RouterLink",{attrs:{to:"/guide/ethereum-provider.html#ethereum-request-args"}},[a("code",[e._v("ethereum.request()")])]),e._v(".\nFor example, here are a couple of actions performed using first "),a("code",[e._v("window.web3")]),e._v(", and then their equivalents using "),a("code",[e._v("window.ethereum")]),e._v(".")],1),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("/**\n * Getting Accounts\n */")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// window.web3")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" accounts "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" web3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("eth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("accounts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// window.ethereum")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" accounts "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("await")]),e._v(" ethereum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("request")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("method")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'eth_accounts'")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("/**\n * Sending a Transaction\n */")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// window.web3")]),e._v("\nweb3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("eth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sendTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("to")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'0x...'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[e._v("'from'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'0x...'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("value")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'0x...'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// And so on...")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" result")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Handle the result")]),e._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// window.ethereum")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("try")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" transactionHash "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("await")]),e._v(" ethereum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("request")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("method")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'eth_sendTransaction'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("params")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("to")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'0x...'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[e._v("'from'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'0x...'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("value")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'0x...'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// And so on...")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Handle the result")]),e._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("transactionHash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("catch")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("h3",{attrs:{id:"using-an-updated-convenience-library"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-an-updated-convenience-library"}},[e._v("#")]),e._v(" Using an Updated Convenience library")]),e._v(" "),a("p",[e._v("If you decide that you need a convenience library, you have to convert your usage of "),a("code",[e._v("window.web3")]),e._v(" to an updated convenience library.\nWe recommend "),a("a",{attrs:{href:"https://npmjs.com/package/ethers",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("ethers")]),a("OutboundLink")],1),e._v(" ("),a("a",{attrs:{href:"https://docs.ethers.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("documentation"),a("OutboundLink")],1),e._v(").")]),e._v(" "),a("h3",{attrs:{id:"using-metamask-legacy-web3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-metamask-legacy-web3"}},[e._v("#")]),e._v(" Using "),a("code",[e._v("@metamask/legacy-web3")])]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),a("p",[e._v("We strongly recommend that you consider one of the other two migration paths before resorting to this one.\nIt is not future-proof, and we will not add new features to it.")])]),e._v(" "),a("p",[e._v("Finally, if you just want your web3 site to continue to work, we created "),a("a",{attrs:{href:"https://npmjs.com/package/@metamask/legacy-web3",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("@metamask/legacy-web3")]),a("OutboundLink")],1),e._v(".\nThis package is a drop-in replacement for our "),a("code",[e._v("window.web3")]),e._v(" that you can add to your website even before remove "),a("code",[e._v("window.web3")]),e._v(" on all platforms.")]),e._v(" "),a("p",[a("code",[e._v("@metamask/legacy-web3")]),e._v(" should work exactly like our injected "),a("code",[e._v("window.web3")]),e._v(", including by refreshing the page on chain/network changes, but "),a("em",[e._v("we cannot guarantee that it works perfectly")]),e._v(".\nWe will not fix any future incompatibilities between "),a("code",[e._v("web3@0.20.7")]),e._v(" and MetaMask itself, nor will we fix any bugs in "),a("code",[e._v("web3@0.20.7")]),e._v(" itself.")]),e._v(" "),a("p",[e._v("For installation and usage instructions, please see the "),a("a",{attrs:{href:"https://npmjs.com/package/@metamask/legacy-web3",target:"_blank",rel:"noopener noreferrer"}},[e._v("npm listing"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"using-the-metamask-legacy-web3-extension"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-the-metamask-legacy-web3-extension"}},[e._v("#")]),e._v(" Using the MetaMask Legacy Web3 Extension")]),e._v(" "),a("p",[e._v("We created the "),a("a",{attrs:{href:"https://github.com/MetaMask/legacy-web3-extension",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[e._v("MetaMask Legacy Web3 Extension")]),a("OutboundLink")],1),e._v(" for any users of websites that still expect "),a("code",[e._v("window.web3")]),e._v(" to be injected. If you install this extension alongside the regular MetaMask wallet extension, websites that rely on our old window.web3 API should start working again.")]),e._v(" "),a("p",[e._v("As with the regular extension, itâ€™s critical that you only install from the official browser extension stores. Please follow the relevant link below to install the Legacy Web3 extension in your browser:")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://chrome.google.com/webstore/detail/metamask-legacy-web3/dgoegggfhkapjphahmgihfgemkgecdgl",target:"_blank",rel:"noopener noreferrer"}},[e._v("Chrome, Brave"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://microsoftedge.microsoft.com/addons/detail/metamask-legacy-web3/obkfjbjkiofoponpkmphnpaaadebfloh?hl=en-US",target:"_blank",rel:"noopener noreferrer"}},[e._v("Edge"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://addons.mozilla.org/en-US/firefox/addon/metamask-legacy-web3/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Firefox"),a("OutboundLink")],1)])]),e._v(" "),a("h2",{attrs:{id:"migrating-to-the-new-provider-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#migrating-to-the-new-provider-api"}},[e._v("#")]),e._v(" Migrating to the New Provider API")]),e._v(" "),a("h3",{attrs:{id:"handling-eth-chainid-return-values"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#handling-eth-chainid-return-values"}},[e._v("#")]),e._v(" Handling "),a("code",[e._v("eth_chainId")]),e._v(" Return Values")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("eth_chainId")]),e._v(" RPC method now returns correctly formatted values, e.g. "),a("code",[e._v("0x1")]),e._v(" and "),a("code",[e._v("0x2")]),e._v(", instead of "),a("em",[e._v("incorrectly")]),e._v(" formatted values, e.g. "),a("code",[e._v("0x01")]),e._v(" and "),a("code",[e._v("0x02")]),e._v(".\nMetaMask's implementation of "),a("code",[e._v("eth_chainId")]),e._v(" used to return 0-padded values for the "),a("RouterLink",{attrs:{to:"/guide/ethereum-provider.html#chain-ids"}},[e._v("default Ethereum chains")]),e._v(" "),a("em",[e._v("except")]),e._v(" Kovan.\nIf you expect 0-padded chain ID values from "),a("code",[e._v("eth_chainId")]),e._v(", make sure to update your code to expect the correct format instead.")],1),e._v(" "),a("p",[e._v("For more details on chain IDs and how to handle them, see the "),a("RouterLink",{attrs:{to:"/guide/ethereum-provider.html#chainchanged"}},[a("code",[e._v("chainChanged")]),e._v(" event")]),e._v(".")],1),e._v(" "),a("h3",{attrs:{id:"handling-the-removal-of-chainidchanged"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#handling-the-removal-of-chainidchanged"}},[e._v("#")]),e._v(" Handling the Removal of "),a("code",[e._v("chainIdChanged")])]),e._v(" "),a("p",[a("code",[e._v("chainIdChanged")]),e._v(" is a typo of "),a("code",[e._v("chainChanged")]),e._v(".\nTo migrate, simply listen for "),a("code",[e._v("chainChanged")]),e._v(" instead:")]),e._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Instead of this:")]),e._v("\nethereum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'chainIdChanged'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("chainId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("/* handle the chainId */")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Do this:")]),e._v("\nethereum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'chainChanged'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("chainId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("/* handle the chainId */")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("h3",{attrs:{id:"handling-the-removal-of-isenabled-and-isapproved"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#handling-the-removal-of-isenabled-and-isapproved"}},[e._v("#")]),e._v(" Handling the Removal of "),a("code",[e._v("isEnabled()")]),e._v(" and "),a("code",[e._v("isApproved()")])]),e._v(" "),a("p",[e._v("Before the new provider API shipped, we added the "),a("code",[e._v("_metamask.isEnabled")]),e._v(" and "),a("code",[e._v("_metamask.isApproved")]),e._v(" methods\nto enable web3 sites to check if they have "),a("RouterLink",{attrs:{to:"/guide/rpc-api.html#eth-requestaccounts"}},[e._v("access to the user's accounts")]),e._v(".\n"),a("code",[e._v("isEnabled")]),e._v(" and "),a("code",[e._v("isApproved")]),e._v(" functioned identically, except that "),a("code",[e._v("isApproved")]),e._v(" was "),a("code",[e._v("async")]),e._v(".\nThese methods were arguably never that useful, and they became completely redundant with the introduction of MetaMask's "),a("RouterLink",{attrs:{to:"/guide/rpc-api.html#restricted-methods"}},[e._v("permission system")]),e._v(".")],1),e._v(" "),a("p",[e._v("We recommend that you check for account access in the following ways:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("You can call the "),a("RouterLink",{attrs:{to:"/guide/rpc-api.html#wallet-getpermissions"}},[a("code",[e._v("wallet_getPermissions")]),e._v(" RPC method")]),e._v(" and check for the "),a("code",[e._v("eth_accounts")]),e._v(" permission.")],1)]),e._v(" "),a("li",[a("p",[e._v("You can call the "),a("code",[e._v("eth_accounts")]),e._v(" RPC method and the "),a("RouterLink",{attrs:{to:"/guide/ethereum-provider.html#ethereum-metamask-isunlocked"}},[a("code",[e._v("ethereum._metamask.isUnlocked()")]),e._v(" method")]),e._v(".")],1),e._v(" "),a("ul",[a("li",[a("p",[e._v("MetaMask has to be unlocked before you can access the user's accounts.\nIf the array returned by "),a("code",[e._v("eth_accounts")]),e._v(" is empty, check if MetaMask is locked using "),a("code",[e._v("isUnlocked()")]),e._v(".")])]),e._v(" "),a("li",[a("p",[e._v("If MetaMask is unlocked and you still aren't receiving any accounts, it's time to request accounts using the "),a("RouterLink",{attrs:{to:"/guide/rpc-api.html#eth-requestaccounts"}},[a("code",[e._v("eth_requestAccounts")]),e._v(" RPC method")]),e._v(".")],1)])])])]),e._v(" "),a("h3",{attrs:{id:"handling-the-removal-of-ethereum-publicconfigstore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#handling-the-removal-of-ethereum-publicconfigstore"}},[e._v("#")]),e._v(" Handling the Removal of "),a("code",[e._v("ethereum.publicConfigStore")])]),e._v(" "),a("p",[e._v("How to handle this change depends on if and how you relied on the "),a("code",[e._v("publicConfigStore")]),e._v(".\nWe have seen examples of listening for provider state changes the "),a("code",[e._v("publicConfigStore")]),e._v(" "),a("code",[e._v("data")]),e._v(" event, and accessing the "),a("code",[e._v("publicConfigStore")]),e._v(" internal state directly.")]),e._v(" "),a("p",[e._v("We recommend that you search your code and its dependencies for references to "),a("code",[e._v("publicConfigStore")]),e._v(".\nIf you find any references, you should understand what it's being used for, and migrate to "),a("RouterLink",{attrs:{to:"/guide/ethereum-provider.html#using-the-provider"}},[e._v("one of the recommended provider APIs")]),e._v(" instead.\nIf you don't find any references, you should not be affected by this change.")],1),e._v(" "),a("p",[e._v("Although it is possible that your dependencies use the "),a("code",[e._v("publicConfigStore")]),e._v(", we have confirmed that the latest versions (as of January 2021) of the following common libraries were not affected by this change:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("ethers")])]),e._v(" "),a("li",[a("code",[e._v("web3")]),e._v(" (web3.js)")])]),e._v(" "),a("h3",{attrs:{id:"handling-the-removal-of-ethereum-autorefreshonnetworkchange"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#handling-the-removal-of-ethereum-autorefreshonnetworkchange"}},[e._v("#")]),e._v(" Handling the Removal of "),a("code",[e._v("ethereum.autoRefreshOnNetworkChange")])]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("ethereum.autoRefreshOnNetworkChange")]),e._v(" was a mutable boolean property used to control whether MetaMask reloaded the page on chain/network changes.\nHowever, it only caused the page to be reloaded if the a script access a property on "),a("code",[e._v("window.web3")]),e._v(".\nTherefore, this property was removed along with "),a("code",[e._v("window.web3")]),e._v(".")]),e._v(" "),a("p",[e._v("Despite this, we still recommend reloading the page on chain changes.\nSome convenience libraries, such as "),a("a",{attrs:{href:"https://www.npmjs.com/package/ethers",target:"_blank",rel:"noopener noreferrer"}},[e._v("ethers"),a("OutboundLink")],1),e._v(", will continue to reload the page by default.\nIf you don't use such a convenience library, you'll have to reload the page manually.\nPlease see the "),a("RouterLink",{attrs:{to:"/guide/ethereum-provider.html#chainchanged"}},[a("code",[e._v("chainChanged")]),e._v(" event")]),e._v(" for details.")],1)])}),[],!1,null,null,null);t.default=s.exports}}]);